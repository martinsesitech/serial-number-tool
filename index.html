<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Serial Number Tool</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: linear-gradient(135deg, #eff6ff 0%, #e0e7ff 100%);
      min-height: 100vh;
      padding: 2rem;
    }

    .container {
      max-width: 1024px;
      margin: 0 auto;
    }

    .card {
      background: white;
      border-radius: 1rem;
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
      overflow: hidden;
    }

    .header {
      background: linear-gradient(135deg, #2563eb 0%, #4f46e5 100%);
      padding: 1.5rem;
      color: white;
    }

    .header-title {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin-bottom: 0.5rem;
    }

    .header-title h1 {
      font-size: 1.5rem;
      font-weight: bold;
    }

    .header-subtitle {
      color: #bfdbfe;
      font-size: 0.875rem;
    }

    .mode-switcher {
      padding: 1.5rem;
      border-bottom: 1px solid #e5e7eb;
      display: flex;
      gap: 1rem;
    }

    .mode-btn {
      flex: 1;
      padding: 0.75rem 1.5rem;
      border-radius: 0.5rem;
      font-weight: 600;
      border: none;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
    }

    .mode-btn.active {
      background: #2563eb;
      color: white;
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
    }

    .mode-btn.inactive {
      background: #f3f4f6;
      color: #4b5563;
    }

    .mode-btn.inactive:hover {
      background: #e5e7eb;
    }

    .form-section {
      padding: 1.5rem;
    }

    .form-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 1.5rem;
    }

    @media (min-width: 768px) {
      .form-grid {
        grid-template-columns: 1fr 1fr;
      }
    }

    .form-group {
      display: flex;
      flex-direction: column;
    }

    .form-group.full {
      grid-column: 1 / -1;
    }

    .form-label {
      font-size: 0.875rem;
      font-weight: 600;
      color: #374151;
      margin-bottom: 0.5rem;
    }

    .form-input, .form-select {
      width: 100%;
      padding: 0.75rem 1rem;
      border: 2px solid #e5e7eb;
      border-radius: 0.5rem;
      font-size: 1rem;
      transition: border-color 0.2s;
    }

    .form-input:focus, .form-select:focus {
      outline: none;
      border-color: #2563eb;
    }

    .form-input.mono {
      font-family: 'Courier New', monospace;
      font-size: 1.125rem;
      letter-spacing: 0.1em;
      text-transform: uppercase;
    }

    .form-hint {
      font-size: 0.75rem;
      color: #6b7280;
      margin-top: 0.25rem;
    }

    .submit-btn {
      width: 100%;
      margin-top: 1.5rem;
      padding: 1rem;
      border: none;
      border-radius: 0.5rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      font-size: 1rem;
    }

    .submit-btn.encode {
      background: linear-gradient(135deg, #2563eb 0%, #4f46e5 100%);
      color: white;
      box-shadow: 0 10px 15px -3px rgba(37, 99, 235, 0.3);
    }

    .submit-btn.encode:hover {
      box-shadow: 0 20px 25px -5px rgba(37, 99, 235, 0.4);
    }

    .submit-btn.decode {
      background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
      color: white;
      box-shadow: 0 10px 15px -3px rgba(79, 70, 229, 0.3);
    }

    .submit-btn.decode:hover {
      box-shadow: 0 20px 25px -5px rgba(79, 70, 229, 0.4);
    }

    .error-box {
      margin: 0 1.5rem 1.5rem;
      background: #fef2f2;
      border: 2px solid #fecaca;
      border-radius: 0.5rem;
      padding: 1rem;
      display: flex;
      gap: 0.75rem;
    }

    .error-icon {
      flex-shrink: 0;
      margin-top: 0.125rem;
    }

    .error-title {
      font-weight: 600;
      color: #7f1d1d;
    }

    .error-message {
      color: #991b1b;
      font-size: 0.875rem;
      margin-top: 0.25rem;
    }

    .result-box {
      margin: 0 1.5rem 1.5rem;
      background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
      border: 2px solid #86efac;
      border-radius: 0.5rem;
      padding: 1.5rem;
    }

    .result-header {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 1rem;
    }

    .result-title {
      font-weight: bold;
      color: #14532d;
      font-size: 1.125rem;
    }

    .serial-display {
      background: white;
      border-radius: 0.5rem;
      padding: 1.5rem;
      margin-bottom: 1rem;
      border: 2px solid #86efac;
    }

    .serial-label {
      font-size: 0.875rem;
      color: #4b5563;
      margin-bottom: 0.5rem;
    }

    .serial-value {
      font-size: 2.25rem;
      font-family: 'Courier New', monospace;
      font-weight: bold;
      color: #111827;
      letter-spacing: 0.1em;
    }

    .details-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
    }

    .detail-card {
      background: white;
      border-radius: 0.5rem;
      padding: 1rem;
    }

    .detail-card.full {
      grid-column: 1 / -1;
    }

    .detail-label {
      font-size: 0.75rem;
      color: #4b5563;
      margin-bottom: 0.25rem;
    }

    .detail-value {
      font-weight: 600;
      color: #111827;
    }

    .technical-details {
      margin-top: 1rem;
    }

    .technical-summary {
      cursor: pointer;
      font-size: 0.875rem;
      color: #4b5563;
      font-weight: 500;
      padding: 0.5rem 0;
    }

    .technical-summary:hover {
      color: #111827;
    }

    .technical-content {
      margin-top: 0.75rem;
      background: #f9fafb;
      border-radius: 0.5rem;
      padding: 1rem;
      font-size: 0.75rem;
      font-family: 'Courier New', monospace;
    }

    .technical-row {
      margin-bottom: 0.5rem;
    }

    .technical-row:last-child {
      margin-bottom: 0;
    }

    .tech-label {
      color: #4b5563;
    }

    .tech-value {
      color: #111827;
      margin-left: 0.5rem;
      word-break: break-all;
    }

    svg {
      width: 1.5rem;
      height: 1.5rem;
    }

    .icon-sm {
      width: 1.25rem;
      height: 1.25rem;
    }

    .icon-lg {
      width: 2rem;
      height: 2rem;
    }

    .rotate-180 {
      transform: rotate(180deg);
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState } = React;

    const Hash = ({ className }) => (
      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <line x1="4" y1="9" x2="20" y2="9" strokeWidth="2"></line>
        <line x1="4" y1="15" x2="20" y2="15" strokeWidth="2"></line>
        <line x1="10" y1="3" x2="8" y2="21" strokeWidth="2"></line>
        <line x1="16" y1="3" x2="14" y2="21" strokeWidth="2"></line>
      </svg>
    );

    const CheckCircle = ({ className }) => (
      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
        <polyline strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" points="22 4 12 14.01 9 11.01"></polyline>
      </svg>
    );

    const AlertCircle = ({ className }) => (
      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <circle cx="12" cy="12" r="10" strokeWidth="2"></circle>
        <line x1="12" y1="8" x2="12" y2="12" strokeWidth="2"></line>
        <line x1="12" y1="16" x2="12.01" y2="16" strokeWidth="2"></line>
      </svg>
    );

    const ArrowRightLeft = ({ className }) => (
      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path>
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M7 16l-4-4m0 0l4-4m-4 4h18"></path>
      </svg>
    );

    const SerialNumberTool = () => {
      const [mode, setMode] = useState('encode');
      const [formData, setFormData] = useState({
        year: '26',
        product: '2',
        batch: '1',
        model: '100',
        unit: '1'
      });
      const [serialInput, setSerialInput] = useState('');
      const [result, setResult] = useState(null);
      const [error, setError] = useState('');

      const PRIME_MULTIPLIER = BigInt('982451653');
      const MODULO = BigInt('2821109907456');
      const SECRET_KEY = BigInt('7538964201');

      const productNames = {
        '1': 'GrainMate',
        '2': 'FarmSense',
        '3': 'Future Product',
        '4': 'Future Product',
        '5': 'Future Product',
        '6': 'Future Product',
        '7': 'Future Product',
        '8': 'Future Product',
        '9': 'Future Product'
      };

      const getModelDisplay = (productCode, model) => {
        if (productCode === 1 || productCode === '1') return `GM-${String(model).padStart(3, '0')}`;
        if (productCode === 2 || productCode === '2') return `FS-${String(model).padStart(3, '0')}`;
        return `MODEL-${String(model).padStart(3, '0')}`;
      };

      const encodeSerial = () => {
        try {
          setError('');
          setResult(null);

          const year = parseInt(formData.year);
          const product = parseInt(formData.product);
          const batch = parseInt(formData.batch);
          const model = parseInt(formData.model);
          const unit = parseInt(formData.unit);

          if (year < 0 || year > 99) throw new Error('Year must be between 0 and 99');
          if (product < 1 || product > 9) throw new Error('Product must be between 1 and 9');
          if (batch < 1 || batch > 999) throw new Error('Batch must be between 1 and 999');
          if (model < 1 || model > 999) throw new Error('Model must be between 1 and 999');
          if (unit < 1 || unit > 9999) throw new Error('Unit must be between 1 and 9999');

          const dataString = 
            String(year).padStart(2, '0') +
            String(product) +
            String(batch).padStart(3, '0') +
            String(model).padStart(3, '0') +
            String(unit).padStart(4, '0');

          const numericValue = BigInt(dataString);
          
          // Encode: multiply by prime and take modulo, then XOR
          const afterMultiply = (numericValue * PRIME_MULTIPLIER) % MODULO;
          const afterXOR = afterMultiply ^ SECRET_KEY;

          let base36String = afterXOR.toString(36).toUpperCase();

          if (base36String.length > 8) {
            throw new Error('Data overflow - exceeds 8 characters');
          }
          base36String = base36String.padStart(8, '0');

          setResult({
            serial: base36String,
            dataString: dataString,
            numericValue: numericValue.toString(),
            afterMultiply: afterMultiply.toString(),
            afterXOR: afterXOR.toString(),
            productName: productNames[String(product)],
            modelDisplay: getModelDisplay(String(product), model),
            fullYear: 2000 + year,
            year: year,
            product: product,
            batch: batch,
            model: model,
            unit: unit
          });

        } catch (err) {
          setError(err.message);
        }
      };

      const decodeSerial = () => {
        try {
          setError('');
          setResult(null);

          let serial = serialInput.toUpperCase().trim();
          
          if (serial.length !== 8) {
            throw new Error('Serial must be exactly 8 characters');
          }

          if (!/^[0-9A-Z]+$/.test(serial)) {
            throw new Error('Serial contains invalid characters. Use only 0-9 and A-Z');
          }

          // Decode: parse from base36
          const afterXOR = BigInt(parseInt(serial, 36));
          
          // Reverse XOR
          const afterMultiply = afterXOR ^ SECRET_KEY;
          
          // Reverse multiplication using modular inverse
          const modInverse = modularInverse(PRIME_MULTIPLIER, MODULO);
          const numericValue = (afterMultiply * modInverse) % MODULO;

          const dataString = numericValue.toString().padStart(13, '0');

          const year = parseInt(dataString.substring(0, 2));
          const productCode = parseInt(dataString.substring(2, 3));
          const batch = parseInt(dataString.substring(3, 6));
          const model = parseInt(dataString.substring(6, 9));
          const unit = parseInt(dataString.substring(9, 13));

          if (year < 0 || year > 99) {
            throw new Error('Invalid serial: year out of range');
          }
          if (productCode < 1 || productCode > 9) {
            throw new Error('Invalid serial: product code out of range');
          }
          if (batch < 1 || batch > 999) {
            throw new Error('Invalid serial: batch out of range');
          }
          if (model < 1 || model > 999) {
            throw new Error('Invalid serial: model out of range');
          }
          if (unit < 1 || unit > 9999) {
            throw new Error('Invalid serial: unit out of range');
          }

          setResult({
            serial: serial,
            dataString: dataString,
            numericValue: numericValue.toString(),
            afterMultiply: afterMultiply.toString(),
            afterXOR: afterXOR.toString(),
            productName: productNames[String(productCode)],
            modelDisplay: getModelDisplay(productCode, model),
            fullYear: 2000 + year,
            year: year,
            product: productCode,
            batch: batch,
            model: model,
            unit: unit
          });

        } catch (err) {
          setError(err.message);
        }
      };

      const modularInverse = (a, m) => {
        let t = BigInt(0);
        let newt = BigInt(1);
        let r = m;
        let newr = a;
        
        while (newr !== BigInt(0)) {
          const quotient = r / newr;
          
          let temp = newt;
          newt = t - quotient * newt;
          t = temp;
          
          temp = newr;
          newr = r - quotient * newr;
          r = temp;
        }
        
        if (r > BigInt(1)) {
          throw new Error('Modular inverse does not exist');
        }
        
        if (t < BigInt(0)) {
          t = t + m;
        }
        
        return t;
      };

      const handleInputChange = (field, value) => {
        setFormData(prev => ({
          ...prev,
          [field]: value
        }));
      };

      const switchMode = (newMode) => {
        setMode(newMode);
        setResult(null);
        setError('');
      };

      return (
        <div className="container">
          <div className="card">
            <div className="header">
              <div className="header-title">
                <Hash className="icon-lg" />
                <h1>Serial Number Tool</h1>
              </div>
              <p className="header-subtitle">Encode and decode serial numbers</p>
            </div>

            <div className="mode-switcher">
              <button
                onClick={() => switchMode('encode')}
                className={`mode-btn ${mode === 'encode' ? 'active' : 'inactive'}`}
              >
                <ArrowRightLeft className="icon-sm" />
                Encode
              </button>
              <button
                onClick={() => switchMode('decode')}
                className={`mode-btn ${mode === 'decode' ? 'active' : 'inactive'}`}
              >
                <ArrowRightLeft className="icon-sm rotate-180" />
                Decode
              </button>
            </div>

            {mode === 'encode' && (
              <div className="form-section">
                <div className="form-grid">
                  <div className="form-group">
                    <label className="form-label">Manufacturing Year (00-99)</label>
                    <input
                      type="number"
                      min="0"
                      max="99"
                      value={formData.year}
                      onChange={(e) => handleInputChange('year', e.target.value)}
                      className="form-input"
                      placeholder="26"
                    />
                    <p className="form-hint">For 2026, enter: 26</p>
                  </div>

                  <div className="form-group">
                    <label className="form-label">Product Line (1-9)</label>
                    <select
                      value={formData.product}
                      onChange={(e) => handleInputChange('product', e.target.value)}
                      className="form-select"
                    >
                      <option value="1">1 - GrainMate</option>
                      <option value="2">2 - FarmSense</option>
                      <option value="3">3 - Future Product</option>
                      <option value="4">4 - Future Product</option>
                      <option value="5">5 - Future Product</option>
                      <option value="6">6 - Future Product</option>
                      <option value="7">7 - Future Product</option>
                      <option value="8">8 - Future Product</option>
                      <option value="9">9 - Future Product</option>
                    </select>
                  </div>

                  <div className="form-group">
                    <label className="form-label">Batch Number (1-999)</label>
                    <input
                      type="number"
                      min="1"
                      max="999"
                      value={formData.batch}
                      onChange={(e) => handleInputChange('batch', e.target.value)}
                      className="form-input"
                      placeholder="1"
                    />
                  </div>

                  <div className="form-group">
                    <label className="form-label">Model Number (1-999)</label>
                    <input
                      type="number"
                      min="1"
                      max="999"
                      value={formData.model}
                      onChange={(e) => handleInputChange('model', e.target.value)}
                      className="form-input"
                      placeholder="100"
                    />
                  </div>

                  <div className="form-group full">
                    <label className="form-label">Unit Number (1-9999)</label>
                    <input
                      type="number"
                      min="1"
                      max="9999"
                      value={formData.unit}
                      onChange={(e) => handleInputChange('unit', e.target.value)}
                      className="form-input"
                      placeholder="1"
                    />
                  </div>
                </div>

                <button onClick={encodeSerial} className="submit-btn encode">
                  Generate Serial Number
                </button>
              </div>
            )}

            {mode === 'decode' && (
              <div className="form-section">
                <div className="form-group">
                  <label className="form-label">Serial Number (8 characters)</label>
                  <input
                    type="text"
                    maxLength="8"
                    value={serialInput}
                    onChange={(e) => setSerialInput(e.target.value.toUpperCase())}
                    className="form-input mono"
                    placeholder="K9Z2M7A2"
                  />
                  <p className="form-hint">Enter an 8-character serial number</p>
                </div>

                <button onClick={decodeSerial} className="submit-btn decode">
                  Decode Serial Number
                </button>
              </div>
            )}

            {error && (
              <div className="error-box">
                <AlertCircle className="error-icon icon-sm" style={{color: '#dc2626'}} />
                <div>
                  <h3 className="error-title">Error</h3>
                  <p className="error-message">{error}</p>
                </div>
              </div>
            )}

            {result && (
              <div className="result-box">
                <div className="result-header">
                  <CheckCircle style={{color: '#16a34a'}} />
                  <h3 className="result-title">
                    {mode === 'encode' ? 'Serial Generated Successfully' : 'Serial Decoded Successfully'}
                  </h3>
                </div>

                <div className="serial-display">
                  <p className="serial-label">Serial Number</p>
                  <p className="serial-value">{result.serial}</p>
                </div>

                <div className="details-grid">
                  <div className="detail-card">
                    <p className="detail-label">Manufacturing Year</p>
                    <p className="detail-value">{result.fullYear}</p>
                  </div>
                  <div className="detail-card">
                    <p className="detail-label">Product Line</p>
                    <p className="detail-value">{result.productName}</p>
                  </div>
                  <div className="detail-card">
                    <p className="detail-label">Batch Number</p>
                    <p className="detail-value">#{String(result.batch).padStart(3, '0')}</p>
                  </div>
                  <div className="detail-card">
                    <p className="detail-label">Model</p>
                    <p className="detail-value">{result.modelDisplay}</p>
                  </div>
                  <div className="detail-card full">
                    <p className="detail-label">Unit Number</p>
                    <p className="detail-value">#{String(result.unit).padStart(4, '0')}</p>
                  </div>
                </div>

                <details className="technical-details">
                  <summary className="technical-summary">Show Technical Details</summary>
                  <div className="technical-content">
                    <div className="technical-row">
                      <span className="tech-label">Data String:</span>
                      <span className="tech-value">{result.dataString}</span>
                    </div>
                    <div className="technical-row">
                      <span className="tech-label">Numeric Value:</span>
                      <span className="tech-value">{result.numericValue}</span>
                    </div>
                    <div className="technical-row">
                      <span className="tech-label">After Multiply & Modulo:</span>
                      <span className="tech-value">{result.afterMultiply}</span>
                    </div>
                    <div className="technical-row">
                      <span className="tech-label">After XOR (Final):</span>
                      <span className="tech-value">{result.afterXOR}</span>
                    </div>
                  </div>
                </details>
              </div>
            )}
          </div>
        </div>
      );
    };

    ReactDOM.render(<SerialNumberTool />, document.getElementById('root'));
  </script>
</body>
</html>
